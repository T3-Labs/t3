name: Pull Request Validation

on:
  pull_request:
    branches: [main, develop]

jobs:
  validate:
    name: Validate PR
    runs-on: ubuntu-latest
    
    steps:
      - uses: actions/checkout@v4
      
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"
      
      - name: Install uv
        uses: astral-sh/setup-uv@v3
      
      - name: Install dependencies
        run: |
          uv sync
          uv pip install -e .
      
      - name: Check code formatting
        run: |
          uv run ruff format --check .
      
      - name: Run linting
        run: |
          uv run ruff check .
      
      - name: Run tests with coverage
        run: |
          uv pip install pytest-cov
          uv run pytest --cov=t3 --cov-report=term-missing
      
      - name: Test CLI installation
        run: |
          source .venv/bin/activate
          t3 --version
          t3 status
      
      - name: Verify package can be built
        run: |
          python -m pip install build
          python -m build
